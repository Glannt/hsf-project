<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Manager - Product Management</title>
    <link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/assets/css/style.css}">
</head>
<body class="bg-light">
<div class="container mt-4">
    <div class="d-flex justify-content-end align-items-center mb-3">
        <form th:action="@{/logout}" method="post" style="display:inline;">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="btn btn-outline-danger">
                <i class="fas fa-sign-out-alt"></i> Log out
            </button>
        </form>
    </div>
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-primary">Product Management (Manager)</h2>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a th:href="@{/}">Home</a></li>
                <li class="breadcrumb-item"><a th:href="@{/manager}">Manager</a></li>
                <li class="breadcrumb-item active">Products</li>
            </ol>
        </nav>
    </div>

    <!-- Success/Error Messages -->
    <div th:if="${param.success}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:if="${param.success == 'item_added'}">Computer item "<span th:text="${param.message}"></span>" added successfully!</span>
        <span th:if="${param.success == 'item_updated'}">Computer item updated successfully!</span>
        <span th:if="${param.success == 'item_deleted'}">Computer item deleted successfully!</span>
        <span th:if="${param.success == 'pc_added'}">PC "<span th:text="${param.message}"></span>" added successfully!</span>
        <span th:if="${param.success == 'pc_deleted'}">PC deleted successfully!</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    
    <div th:if="${param.error}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <span th:text="${param.error == 'item_add_failed'} ? 'Failed to add computer item!' :
                       ${param.error == 'item_update_failed'} ? 'Failed to update computer item!' :
                       ${param.error == 'item_delete_failed'} ? 'Failed to delete computer item!' :
                       ${param.error == 'pc_add_failed'} ? 'Failed to add PC!' :
                       ${param.error == 'pc_delete_failed'} ? 'Failed to delete PC!' : 'Operation failed!'"></span>
        <span th:if="${param.message}" th:text="' - ' + ${param.message}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- PC Management Section -->
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">PC Management</h5>
            <a th:href="@{/manager/products/add-pc}" class="btn btn-primary">
                <i class="icon-plus"></i> Add New PC
            </a>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Price (VND)</th>
                            <th>Description</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="pc : ${pcs.content}">
                            <td th:text="${pc.id}"></td>
                            <td th:text="${pc.name}"></td>
                            <td th:text="${#numbers.formatInteger(pc.price, 0, 'COMMA')}"></td>
                            <td th:text="${pc.description}"></td>
                            <td>
                                <button class="btn btn-info btn-sm" data-bs-toggle="modal" 
                                        th:data-bs-target="'#viewPcModal' + ${pc.id}">
                                    <i class="icon-eye"></i> View
                                </button>
                                <button class="btn btn-warning btn-sm" data-bs-toggle="modal" 
                                        th:data-bs-target="'#editPcModal' + ${pc.id}">
                                    <i class="icon-edit"></i> Edit
                                </button>
                                <form th:action="@{'/manager/products/pc/delete/' + ${pc.id}}" method="post" 
                                      onsubmit="return confirm('Are you sure you want to delete this PC?');" 
                                      style="display: inline;">
                                    <button type="submit" class="btn btn-sm btn-danger">
                                        <i class="icon-trash-2"></i> Delete
                                    </button>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Computer Items Management Section -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Computer Items Management</h5>
            <a th:href="@{/manager/products/add-item}" class="btn btn-success">
                <i class="icon-plus"></i> Add New Item
            </a>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Price (VND)</th>
                            <th>Category</th>
                            <th>Brand</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="item : ${computerItems.content}">
                            <td th:text="${item.id}"></td>
                            <td th:text="${item.name}"></td>
                            <td th:text="${#numbers.formatInteger(item.price, 0, 'COMMA')}"></td>
                            <td th:text="${item.category != null ? item.category.name : 'N/A'}"></td>
                            <td th:text="${item.brand != null ? item.brand : 'N/A'}"></td>
                            <td>
                                <button class="btn btn-info btn-sm" data-bs-toggle="modal" 
                                        th:data-bs-target="'#viewItemModal' + ${item.id}">
                                    <i class="icon-eye"></i> View
                                </button>
                                <button class="btn btn-warning btn-sm" data-bs-toggle="modal" 
                                        th:data-bs-target="'#editItemModal' + ${item.id}">
                                    <i class="icon-edit"></i> Edit
                                </button>
                                <form th:action="@{'/manager/products/item/delete/' + ${item.id}}" method="post" 
                                      onsubmit="return confirm('Are you sure you want to delete this item?');" 
                                      style="display: inline;">
                                    <button type="submit" class="btn btn-sm btn-danger">
                                        <i class="icon-trash-2"></i> Delete
                                    </button>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Add PC Modal -->
<div class="modal fade" id="addPcModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Add New PC</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form th:action="@{/manager/products/pc/save}" method="post">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="pcName" class="form-label">PC Name *</label>
                                <input type="text" class="form-control" id="pcName" name="name" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="pcPrice" class="form-label">Price (VND) *</label>
                                <input type="number" class="form-control" id="pcPrice" name="price" required>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="pcDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="pcDescription" name="description" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add PC</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Computer Item Modal -->
<div class="modal fade" id="addItemModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">Add New Computer Item</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form th:action="@{/manager/products/item/save}" method="post">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="itemName" class="form-label">Item Name *</label>
                                <input type="text" class="form-control" id="itemName" name="name" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="itemPrice" class="form-label">Price (VND) *</label>
                                <input type="number" class="form-control" id="itemPrice" name="price" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="itemBrand" class="form-label">Brand</label>
                                <input type="text" class="form-control" id="itemBrand" name="brand">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="itemModel" class="form-label">Model</label>
                                <input type="text" class="form-control" id="itemModel" name="model">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="itemCategory" class="form-label">Category</label>
                        <select class="form-select" id="itemCategory" name="category.id">
                            <option value="">Select Category</option>
                            <option th:each="category : ${categories}" 
                                    th:value="${category.id}" 
                                    th:text="${category.name}">Category Name</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="itemDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="itemDescription" name="description" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Add Item</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script th:src="@{/assets/js/jquery.min.js}"></script>
<script th:src="@{/assets/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/assets/js/main.js}"></script>
</body>
</html> 