<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin Order Management</title>
    <link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/assets/css/style.css}">
</head>
<body class="bg-light">
<div class="container mt-4">
    <div class="d-flex justify-content-end mb-3">
        <form th:action="@{/logout}" method="post" style="display:inline;">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="btn btn-outline-danger btn-sm">Logout</button>
        </form>
    </div>
    <!-- Navigation Menu -->
    <div class="row mb-4">
        <div class="col-12">
            <nav class="navbar navbar-expand-lg navbar-light bg-light rounded">
                <div class="container-fluid">
                    <span class="navbar-brand">Admin Panel</span>
                    <div class="navbar-nav">
                        <a class="nav-link" th:href="@{/admin}">Dashboard</a>
                        <a class="nav-link active" th:href="@{/orders/admin}">Orders</a>
                        <a class="nav-link" th:href="@{/admin/product}">Products</a>
                        <a class="nav-link" th:href="@{/admin/users}">Users</a>
                    </div>
                </div>
            </nav>
        </div>
    </div>
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-primary">Order Management</h2>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a th:href="@{/}">Home</a></li>
                <li class="breadcrumb-item"><a th:href="@{/admin}">Admin</a></li>
                <li class="breadcrumb-item active">Orders</li>
            </ol>
        </nav>
    </div>

    <!-- Order Summary Card -->
    <div class="row mb-4">
        <div class="col-lg-12">
            <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <div class="card-body">
                    <h5 class="card-title text-white">Orders Overview</h5>
                    <div class="row">
                        <div class="col-md-3 text-center">
                            <h6>Total Orders</h6>
                            <h4 th:text="${orders != null ? orders.totalElements : 0}">0</h4>
                        </div>
                        <div class="col-md-3 text-center">
                            <h6>Current Page</h6>
                            <h4 th:text="${orders != null ? orders.number + 1 : 1}">1</h4>
                        </div>
                        <div class="col-md-3 text-center">
                            <h6>Total Pages</h6>
                            <h4 th:text="${orders != null ? orders.totalPages : 1}">1</h4>
                        </div>
                        <div class="col-md-3 text-center">
                            <h6>Orders per Page</h6>
                            <h4 th:text="${orders != null ? orders.size : 10}">10</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    
    <!-- Success/Error Messages -->
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${success}">Success message</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    
    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <span th:text="${error}">Error message</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Orders Table -->
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">All Orders</h5>
        </div>
        <div class="card-body">
            <div th:if="${orders != null and orders.content.size() > 0}">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                        <tr>
                            <th>Order Number</th>
                            <th>Customer</th>
                            <th>Status</th>
                            <th>Total Amount</th>
                            <th>Order Date</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="order : ${orders.content}">
                            <td>
                                <strong th:text="${order.orderNumber}">ORD-123456</strong>
                            </td>
                            <td th:text="${order.user.username}">Customer Name</td>
                            <td>
                                <span th:class="|badge ${order.status.name() == 'PENDING' ? 'badge-warning' : 
                                                      order.status.name() == 'CONFIRMED' ? 'badge-info' :
                                                      order.status.name() == 'SHIPPED' ? 'badge-primary' :
                                                      order.status.name() == 'DELIVERED' ? 'badge-success' : 'badge-danger'}|"
                                      th:text="${order.status.displayName}">Status</span>
                            </td>
                            <td>
                                <strong th:text="${#numbers.formatDecimal(order.totalPrice, 1, 'COMMA', 2, 'POINT')} + ' VND'">1,000,000 VND</strong>
                            </td>
                            <td th:text="${#temporals.format(order.orderDate, 'dd/MM/yyyy HH:mm')}">01/01/2024 10:00</td>
                            <td>
                                <div class="btn-group" role="group">
                                    <a th:href="@{'/orders/' + ${order.id}}" class="btn btn-sm btn-outline-info">
                                        <i class="icon-eye"></i> View
                                    </a>
                                    <button type="button" 
                                            class="btn btn-sm btn-outline-warning" 
                                            data-bs-toggle="modal" 
                                            th:data-bs-target="'#updateOrderModal' + ${order.id}">
                                        <i class="icon-edit"></i> Update
                                    </button>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <nav aria-label="Orders Pagination" th:if="${orders.totalPages > 1}">
                    <ul class="pagination justify-content-center">
                        <!-- Previous button -->
                        <li class="page-item" th:classappend="${!orders.hasPrevious()} ? 'disabled'">
                            <a class="page-link page-link-prev" th:href="@{/orders/admin(page=${orders.number - 1})}">
                                <span aria-hidden="true"><i class="icon-long-arrow-left"></i></span>Prev
                            </a>
                        </li>
                        
                        <!-- Page numbers -->
                        <li th:each="page : ${#numbers.sequence(0, orders.totalPages - 1)}"
                            class="page-item"
                            th:classappend="${page == orders.number} ? 'active'">
                            <a class="page-link" th:href="@{/orders/admin(page=${page})}" th:text="${page + 1}">1</a>
                        </li>
                        
                        <!-- Next button -->
                        <li class="page-item" th:classappend="${!orders.hasNext()} ? 'disabled'">
                            <a class="page-link page-link-next" th:href="@{/orders/admin(page=${orders.number + 1})}">
                                Next <span aria-hidden="true"><i class="icon-long-arrow-right"></i></span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            
            <!-- No Orders Message -->
            <div th:if="${orders == null or orders.content.size() == 0}" class="text-center py-5">
                <div class="alert alert-info">
                    <h4><i class="icon-info-circle"></i> No Orders Found</h4>
                    <p>There are no orders in the system yet.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Update Order Status Modals -->
<div th:each="order : ${orders != null ? orders.content : {}}">
    <div class="modal fade" th:id="'updateOrderModal' + ${order.id}" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Update Order Status</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <p><strong>Order Number:</strong> <span th:text="${order.orderNumber}"></span></p>
                        <p><strong>Customer:</strong> <span th:text="${order.user.username}"></span></p>
                        <p><strong>Current Status:</strong> 
                            <span th:class="|badge ${order.status.name() == 'PENDING' ? 'badge-warning' : 
                                                  order.status.name() == 'CONFIRMED' ? 'badge-info' :
                                                  order.status.name() == 'SHIPPED' ? 'badge-primary' :
                                                  order.status.name() == 'DELIVERED' ? 'badge-success' : 'badge-danger'}|"
                                  th:text="${order.status.displayName}"></span>
                        </p>
                    </div>
                    
                    <form th:action="@{/orders/{orderId}/status(orderId=${order.id})}" method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <div class="mb-3">
                            <label th:for="'status' + ${order.id}" class="form-label">New Status:</label>
                            <select th:name="'status'" th:id="'status' + ${order.id}" class="form-select" required>
                                <option value="PENDING" th:selected="${order.status.name() == 'PENDING'}">Pending</option>
                                <option value="CONFIRMED" th:selected="${order.status.name() == 'CONFIRMED'}">Confirmed</option>
                                <option value="SHIPPED" th:selected="${order.status.name() == 'SHIPPED'}">Shipped</option>
                                <option value="DELIVERED" th:selected="${order.status.name() == 'DELIVERED'}">Delivered</option>
                                <option value="CANCELLED" th:selected="${order.status.name() == 'CANCELLED'}">Cancelled</option>
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">Update Status</button>
                        </div>
                    </form>
                </div>

            </div>
        </div>
    </div>
</div>

<script th:src="@{/assets/js/bootstrap.bundle.min.js}"></script>
</body>
</html>