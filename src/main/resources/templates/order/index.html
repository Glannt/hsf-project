<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta
            http-equiv="X-UA-Compatible"
            content="IE=edge"
    />
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta
            name="msapplication-TileColor"
            content="#cc9966"
    />
    <meta
            name="msapplication-config"
            content="assets/images/icons/browserconfig.xml"
    />
    <meta
            name="theme-color"
            content="#ffffff"
    />
    <title>Order Confirmation</title>
    <link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/assets/css/style.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .payment-methods {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .payment-methods {
            margin-top: 25px;
        }
        .payment-methods h4 {
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        .payment-method-option {
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .payment-method-option:hover {
            border-color: #007bff;
            box-shadow: 0 4px 15px rgba(0,123,255,0.15);
            transform: translateY(-2px);
        }
        .payment-method-option.selected {
            border-color: #007bff;
            background: linear-gradient(135deg, #e7f3ff 0%, #cce7ff 100%);
            box-shadow: 0 4px 15px rgba(0,123,255,0.2);
        }
        .payment-method-option > .form-check {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }
        .payment-method-option > .form-check > .custom {
            display: flex;
            justify-content: center;
            align-items: center;
            padding-left: 20px;
        }

        .payment-method-icon {
            font-size: 1.8rem;
            margin-right: 15px;
            vertical-align: middle;
            width: 30px;
            text-align: center;
        }
        .payment-method-details {
            padding: 10px;
        }
        .form-check {
            background: transparent;
            padding: 20px;
            border: none;
            margin: 0;
        }
        .form-check-label {
            display: flex;
            align-items: center;
            font-size: 16px;
            font-weight: 500;
            color: #2c3e50;
            cursor: pointer;
            width: 100%;
        }
        .form-check-input {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            border: 2px solid #dee2e6;
            flex-shrink: 0;
        }
        .form-check-input:checked {
            background-color: #007bff;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.25);
        }
        .form-check-input:focus {
            box-shadow: 0 0 0 3px rgba(0,123,255,0.25);
        }
        .payment-method-option.selected .form-check-label {
            color: #007bff;
            font-weight: 600;
        }
        .payment-method-details small {
            color: #6c757d;
            font-size: 14px;
            line-height: 1.4;
        }
        .payment-method-option.selected .payment-method-details small {
            color: #0056b3;
        }
        .btn-order {
            background: linear-gradient(45deg, #007bff, #0056b3);
            border: none;
            color: white;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        .btn-order:hover {
            background: linear-gradient(45deg, #0056b3, #004085);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,123,255,0.3);
        }
        .summary {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        .loading-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
<div class="page-wrapper">
    <header class="header">
        <!-- Tùy bạn giữ lại hoặc rút gọn -->
        <div class="header-middle sticky-header">
            <div class="container">
                <div class="header-left">
                    <a href="/" class="logo">
                        <img th:src="@{/assets/images/logo.png}" alt="Logo" width="105" height="25">
                    </a>
                    <nav class="main-nav">
                        <ul class="menu sf-arrows">
                            <li><a th:href="@{/}">Home</a></li>
                            <li><a th:href="@{/products}">Shop</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </header>
    <main class=" main">
        <div
                class="page-header text-center"
                style="background-image: url('/assets/images/page-header-bg.jpg')"
        >
            <div class="container">
                <h1 class="page-title">Checkout<span>Shop</span></h1>
            </div>
            <!-- End .container -->
        </div>
        <nav aria-label="breadcrumb" class="breadcrumb-nav">
            <div class="container">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a th:href="@{/}">Home</a>
                    </li>
                    <li class="breadcrumb-item">
                        <a th:href="@{/cart}">Cart</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">
                        Order Confirmation
                    </li>
                </ol>
            </div>
        </nav>
        <div class="page-content">
            <div class="checkout">
                <div class="container">
                    <div th:if="${order != null}">
                        <form th:action="@{/payment/process}" method="post" class="container" id="paymentForm">
                            <div class="row">
                                <div class="col-lg-7">
                                    <h2 class="checkout-title">Billing Details</h2>
                                    <h4>Customer Info</h4>

                                    <label>Username</label>
                                    <input type="text" class="form-control" th:value="${order.user.username}" readonly
                                           disabled/>

                                    <label>Order Number</label>
                                    <input type="text" class="form-control" th:value="${order.orderNumber}" readonly
                                           disabled/>

                                    <label>Status</label>
                                    <input type="text" class="form-control" th:value="${order.status}" readonly
                                           disabled/>

                                    <label>Shipping Address *</label>
                                    <input
                                            type="text"
                                            id="shippingAddress"
                                            name="shippingAddress"
                                            class="form-control"
                                            placeholder="House number and Street name"
                                            required
                                    />
                                </div>
                                <aside class="col-lg-5">
                                    <div class="summary">
                                        <h3 class="summary-title">Your Order</h3>

                                        <table class="table table-summary">
                                            <thead>
                                            <tr>
                                                <th>Product</th>
                                                <th>Total</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr th:each="item : ${order.orderItems}">
                                                <td th:text="${item.productName}">Product Name</td>
                                                <td th:text="${#numbers.formatDecimal(item.subtotal, 1, 'COMMA', 2, 'POINT')}">
                                                    $0.00
                                                </td>
                                            </tr>
                                            <tr class="summary-subtotal">
                                                <td>Subtotal:</td>
                                                <td th:text="${#numbers.formatDecimal(order.totalPrice, 1, 'COMMA', 2, 'POINT')}">
                                                    $0.00
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Shipping:</td>
                                                <td>Free shipping</td>
                                            </tr>
                                            <tr class="summary-total">
                                                <td>Total:</td>
                                                <td th:text="${#numbers.formatDecimal(order.totalPrice, 1, 'COMMA', 2, 'POINT')}">
                                                    $0.00
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>


                                        <div class="payment-methods">
                                            <h4 class="mb-3"><i class="fas fa-credit-card me-3"></i>Payment Methods</h4>
                                            
                                            <div class="payment-method-option" data-method="COD">
                                                <div class="form-check">
                                                    <div class="custom">
                                                        <input class="form-check-input" type="radio" name="paymentMethod" id="cod" value="COD" checked>
                                                    </div>
                                                    <label class="form-check-label" for="cod">
                                                        <i class="fas fa-money-bill-wave text-success payment-method-icon"></i>
                                                        <strong>Cash on Delivery (COD)</strong>
                                                    </label>
                                                </div>
                                                <div class="payment-method-details">
                                                    <small class="text-muted">Pay with cash when your order is delivered to your doorstep. No advance payment required.</small>
                                                </div>
                                            </div>

                                            <div class="payment-method-option" data-method="VNPAY">
                                                <div class="form-check">
                                                    <div class="custom">
                                                        <input class="form-check-input" type="radio" name="paymentMethod" id="vnpay" value="VNPAY">
                                                    </div>
                                                    <label class="form-check-label" for="vnpay">
                                                        <i class="fas fa-credit-card text-primary payment-method-icon"></i>
                                                        <strong>VNPay Online Payment</strong>
                                                    </label>
                                                </div>
                                                <div class="payment-method-details">
                                                    <small class="text-muted">Pay securely online using VNPay gateway. Supports credit cards, debit cards, and bank transfers.</small>
                                                </div>
                                            </div>
                                        </div>

                                        <button type="submit" class="btn btn-order btn-block" id="submitBtn">
                                            <span class="btn-text">Place Order</span>
                                            <span class="btn-hover-text">Proceed to Checkout</span>
                                        </button>
                                    </div>
                                </aside>
                            </div>


                        </form>


                    </div>
                </div>
            </div>
        </div>


        <div th:if="${order == null}" class="text-center mt-5">
            <div class="alert alert-danger">
                <strong>No order information available.</strong>
            </div>
            <a th:href="@{/cart}" class="btn btn-outline-primary">Return to Cart</a>
        </div>
    </main>
    <footer class="footer">
        <div class="footer-middle">
            <div class="container">
                <div class="row">
                    <div class="col-sm-6 col-lg-3">
                        <div class="widget widget-about">
                            <img
                                    src="assets/images/logo.png"
                                    class="footer-logo"
                                    alt="Footer Logo"
                                    width="105"
                                    height="25"
                            />
                            <p>
                                Praesent dapibus, neque id cursus ucibus, tortor neque
                                egestas augue, eu vulputate magna eros eu erat.
                            </p>

                            <div class="social-icons">
                                <a
                                        href="#"
                                        class="social-icon"
                                        target="_blank"
                                        title="Facebook"
                                ><i class="icon-facebook-f"></i
                                ></a>
                                <a
                                        href="#"
                                        class="social-icon"
                                        target="_blank"
                                        title="Twitter"
                                ><i class="icon-twitter"></i
                                ></a>
                                <a
                                        href="#"
                                        class="social-icon"
                                        target="_blank"
                                        title="Instagram"
                                ><i class="icon-instagram"></i
                                ></a>
                                <a
                                        href="#"
                                        class="social-icon"
                                        target="_blank"
                                        title="Youtube"
                                ><i class="icon-youtube"></i
                                ></a>
                                <a
                                        href="#"
                                        class="social-icon"
                                        target="_blank"
                                        title="Pinterest"
                                ><i class="icon-pinterest"></i
                                ></a>
                            </div>
                            <!-- End .soial-icons -->
                        </div>
                        <!-- End .widget about-widget -->
                    </div>
                    <!-- End .col-sm-6 col-lg-3 -->

                    <div class="col-sm-6 col-lg-3">
                        <div class="widget">
                            <h4 class="widget-title">Useful Links</h4>
                            <!-- End .widget-title -->

                            <ul class="widget-list">
                                <li><a href="about.html">About Molla</a></li>
                                <li><a href="#">How to shop on Molla</a></li>
                                <li><a href="#">FAQ</a></li>
                                <li><a href="contact.html">Contact us</a></li>
                                <li><a href="login.html">Log in</a></li>
                            </ul>
                            <!-- End .widget-list -->
                        </div>
                        <!-- End .widget -->
                    </div>
                    <!-- End .col-sm-6 col-lg-3 -->

                    <div class="col-sm-6 col-lg-3">
                        <div class="widget">
                            <h4 class="widget-title">Customer Service</h4>
                            <!-- End .widget-title -->

                            <ul class="widget-list">
                                <li><a href="#">Payment Methods</a></li>
                                <li><a href="#">Money-back guarantee!</a></li>
                                <li><a href="#">Returns</a></li>
                                <li><a href="#">Shipping</a></li>
                                <li><a href="#">Terms and conditions</a></li>
                                <li><a href="#">Privacy Policy</a></li>
                            </ul>
                            <!-- End .widget-list -->
                        </div>
                        <!-- End .widget -->
                    </div>
                    <!-- End .col-sm-6 col-lg-3 -->

                    <div class="col-sm-6 col-lg-3">
                        <div class="widget">
                            <h4 class="widget-title">My Account</h4>
                            <!-- End .widget-title -->

                            <ul class="widget-list">
                                <li><a href="#">Sign In</a></li>
                                <li><a href="cart.html">View Cart</a></li>
                                <li><a href="#">My Wishlist</a></li>
                                <li><a href="#">Track My Order</a></li>
                                <li><a href="#">Help</a></li>
                            </ul>
                            <!-- End .widget-list -->
                        </div>
                        <!-- End .widget -->
                    </div>
                    <!-- End .col-sm-6 col-lg-3 -->
                </div>
                <!-- End .row -->
            </div>
            <!-- End .container -->
        </div>
        <!-- End .footer-middle -->

        <div class="footer-bottom">
            <div class="container">
                <p class="footer-copyright">
                    Copyright © 2019 Molla Store. All Rights Reserved.
                </p>
                <!-- End .footer-copyright -->
                <figure class="footer-payments">
                    <img
                            src="assets/images/payments.png"
                            alt="Payment methods"
                            width="272"
                            height="20"
                    />
                </figure>
                <!-- End .footer-payments -->
            </div>
            <!-- End .container -->
        </div>
        <!-- End .footer-bottom -->
    </footer>

</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
        <div class="spinner"></div>
        <h5>Processing Payment...</h5>
        <p class="text-muted">Please wait while we redirect you to the payment gateway.</p>
    </div>
</div>

<button
        id="scroll-top"
        title="Back to Top"
>
    <i class="icon-arrow-up"></i>
</button>


<script th:src="@{/assets/js/jquery.min.js}"></script>
<script th:src="@{/assets/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/assets/js/jquery.hoverIntent.min.js}"></script>
<script th:src="@{/assets/js/jquery.waypoints.min.js}"></script>
<script th:src="@{/assets/js/superfish.min.js}"></script>
<script th:src="@{/assets/js/owl.carousel.min.js}"></script>
<!-- Main JS File -->
<script th:src="@{/assets/js/main.js}"></script>

<script>
$(document).ready(function() {
    // Payment method selection handling
    $('input[name="paymentMethod"]').change(function() {
        const selectedMethod = $(this).val();
        const submitBtn = $('#submitBtn');
        const btnText = submitBtn.find('.btn-text');
        const btnHoverText = submitBtn.find('.btn-hover-text');
        
        // Remove selected class from all options
        $('.payment-method-option').removeClass('selected');
        
        // Add selected class to current option
        $(this).closest('.payment-method-option').addClass('selected');
        
        if (selectedMethod === 'VNPAY') {
            btnText.text('Pay with VNPay');
            btnHoverText.text('Redirect to VNPay');
            submitBtn.removeClass('btn-success').addClass('btn-primary');
        } else {
            btnText.text('Place Order');
            btnHoverText.text('Confirm Order');
            submitBtn.removeClass('btn-primary').addClass('btn-success');
        }
    });
    
    // Initialize selected state
    $('.payment-method-option').click(function() {
        const radio = $(this).find('input[type="radio"]');
        radio.prop('checked', true).trigger('change');
    });
    
    // Set initial selected state
    $('input[name="paymentMethod"]:checked').closest('.payment-method-option').addClass('selected');
    
    // Form submission handling
    $('#paymentForm').submit(function(e) {
        const selectedMethod = $('input[name="paymentMethod"]:checked').val();
        const shippingAddress = $('#shippingAddress').val().trim();
        
        // Validate shipping address
        if (!shippingAddress) {
            e.preventDefault();
            alert('Please enter your shipping address.');
            $('#shippingAddress').focus();
            return false;
        }
        
        // Show loading overlay for VNPay payments
        if (selectedMethod === 'VNPAY') {
            $('#loadingOverlay').css('display', 'flex');
            
            // Update loading text for VNPay
            $('.loading-content h5').text('Redirecting to VNPay...');
            $('.loading-content p').text('Please wait while we redirect you to the VNPay payment gateway.');
        } else {
            // Show loading for COD as well
            $('#loadingOverlay').css('display', 'flex');
            $('.loading-content h5').text('Processing Order...');
            $('.loading-content p').text('Please wait while we process your cash on delivery order.');
        }
        
        // Disable submit button to prevent double submission
        $('#submitBtn').prop('disabled', true);
        
        // Allow form to submit normally
        return true;
    });
    
    // Handle browser back button
    window.addEventListener('pageshow', function(event) {
        if (event.persisted) {
            $('#loadingOverlay').hide();
            $('#submitBtn').prop('disabled', false);
        }
    });
    
    // Auto-hide loading overlay after 30 seconds (fallback)
    setTimeout(function() {
        $('#loadingOverlay').hide();
        $('#submitBtn').prop('disabled', false);
    }, 30000);
});
</script>
</body>
</html>
